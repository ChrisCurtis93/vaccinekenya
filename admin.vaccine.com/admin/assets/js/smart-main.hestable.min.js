function doFirst(){
	lnklog = document.getElementById("lnklog");
	txtemail = document.getElementById("email");
	txtpassword = document.getElementById("password");
	frm_login = document.getElementById("frm_login");
	lnklog.addEventListener('click', attempt_login, false); 
	
}

function reset_password(){
	email = document.getElementById("tb_email").value;
	mobile = document.getElementById("tb_mobile").value;
	var response;
	var base_url = './data/apis/account-reset.php?email=' + email + '&mobile='+ mobile;
	var form_data = {
		success: 'success',
		message: 'message'
	};
	
	$.ajax({
		type: "GET", 
		url: base_url, 
		dataType : "json",
		data: form_data,
		success: function(response)
		{
			if(response["resultvalue"][0].success == 1){
				swal('Success', response["resultvalue"][0].message, 'success');
			}else{
				swal('Failed', response["resultvalue"][0].message, 'error');
			}
		}  
	}); 	
}

function attempt_login2(){
	var emailvalue = txtemail.value;
	var passwordvalue = txtpassword.value;
	if(emailvalue == "" || passwordvalue == ""){
		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Login Failed missing details.</div>");
	}else{
		$("#loading_point").html("<div role='alert' class='alert alert-warning margin-top-30'><strong>Working!</strong> Loading, Please wait...</div>");
		loginFxN(emailvalue, passwordvalue);
	}
}
function attempt_login (e){
	var emailvalue = txtemail.value;
	var passwordvalue = txtpassword.value;
	if(emailvalue == "" || passwordvalue == ""){
		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Login Failed missing details.</div>");
	}else{
		$("#loading_point").html("<div role='alert' class='alert alert-warning margin-top-30'><strong>Working!</strong> Loading, Please wait...</div>");
		loginFxN(emailvalue, passwordvalue);
	}
}
function loginFxN(emailvalue, passwordvalue){
	//alert(emailvalue + ' ' + passwordvalue);
	var response;
	var base_url = './data/log.php?email=' + emailvalue + '&password='+ passwordvalue;
	var form_data = {
		success: 'success',
		message: 'message',
		userid: 'message'
	};
	
	$.ajax({
		type: "GET", 
		url: base_url, 
		dataType : "json",
		data: form_data,
		success: function(response)
		{
			if(response["resultvalue"][0].success == 1){
				attempt_redirect('./data/auth.php?userid=' + response["resultvalue"][0].message);
			}else{
				$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong>"+response[0].message+".</div>");
			}
		}  
	}); 
}

function attempt_redirect(path){
	var promise=Smartjax.ajax({
		url: path,
		data:{ },
		type: 'POST',
		force:true,
		store: false,
	});
	promise.then(function (apiResult) {
		$("#frm_login").html("");
		$("#loading_point").html("<div role='alert' class='alert alert-success margin-top-30'><strong>Success!</strong> Login Success, System will redirect you shortly...</div>");
		window.location = "./";
	},function(){
		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Redirect failed.</div>");
	})
}
window.addEventListener('load', doFirst, false);